<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />

		<style>
		</style>
	</head>

	<body>

	<script src="js/html2canvas.min.js"></script>
	<!-- 将canvas图片保存成图片 -->
	<script src="js/canvas2image.js"></script>
	<script src="js/base64.js"></script>
		

		<div id="jpg">
			<img src="img/logo.jpg">
		</div>
		<hr>
		<div align="center">
        <div id="content">
				<div id="img_text">2018/5/25，阴，群主拒绝了女装，这个仇，我先记下了</div>
               
        </div>
                
			<div style="padding: 5px 25% 0 25%;">
<!--				<textarea id="textarea" rows="5" contenteditable="true"></textarea>-->
				<textarea v-model="cureInfo.Symptom" id="symptomTxt" oninput="autoTextAreaHeight(this)"></textarea>
				<button id="bt1" type="button" class="mui-btn mui-btn-blue">提交</button>
                    <button id="btnSave">抓取图片1</button>
                     <button id="btnSave2">抓取图片2</button>
                    <button id="Download">下载图片</button>
			</div>
             <div id="images"></div>
		</div>
	</body>
<script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js">
</script>

	<script>
		var myDate = new Date();

		var riqi=myDate.toLocaleDateString()+"，星期"+"日一二三四五六".charAt(new Date().getDay())+"，";
		
		//textarea自动随内容增高
		function autoTextAreaHeight(o) {
			o.style.height = o.scrollTop + o.scrollHeight + "px";
		}
		jQuery(function() {
			var ele = document.getElementById("symptomTxt");
			autoTextAreaHeight(ele);
		});
		
		
		jQuery("#symptomTxt").val(riqi);
		
		var width_img = jQuery("img").width();
		var height_img = jQuery("img").height();
		jQuery("#img_text").height(height_img);
		jQuery("#img_text").width(width_img);
		jQuery("#img_text").css("background-image", "url(logo.png)");
		//jQuery("#jpg").hide();
		jQuery("#bt1").click(function(){
			var str=jQuery("#symptomTxt").val();
			console.log(str);
			jQuery("#img_text").text(str);
		});
	</script>


<script>
/*生成canvas图形*/

// 获取按钮id
var btnSave = document.getElementById("btnSave");
var btnSave2 = document.getElementById("btnSave2");
// 获取内容id
var content = document.getElementById("content");
// 进行canvas生成
btnSave.onclick = function(){

	html2canvas(jQuery("#content").get(0), {
        onrendered: function(canvas) {
        	//添加属性
        	canvas.setAttribute('id','thecanvas');
			//读取属性值
			// var value= canvas.getAttribute('id');
            document.getElementById('images').innerHTML = '';
            document.getElementById('images').appendChild(canvas);
        }
	});
}
btnSave2.onclick = function(){
    html2canvas(document.getElementById('content'), {
        onrendered: function(canvas) {
            document.body.appendChild(canvas);
        },

    });
    }


    
    var Download = document.getElementById("Download");
 //下载图片   
Download.onclick = function(){
	var oCanvas = document.getElementById("thecanvas");

    
    
    
    ctx = oCanvas.getContext("2d"), //对应的CanvasRenderingContext2D对象(画笔)
      img = new Image(),//创建新的图片对象
      base64 = '' ;//base64 
      img.setAttribute("crossOrigin",'Anonymous')
      img.onload = function(){//图片加载完，再draw 和 toDataURL
      ctx.drawImage(img,0,0);    
     base64 = canvas.toDataURL("image/png"); 
       

   };
        var imgData = oCanvas.toDataURL("image/png").replace("image/png", "image/octet-stream");

      window.location.href= imgData;
    
	/*自动保存为png*/
	// 获取图片资源
	//var img_data1 = Canvas2Image.saveAsJPEG(oCanvas, true).getAttribute('src');
    //    console.log(typeof(img_data1));
	//saveFile(img_data1, 'richer.png');
	//*下面的为原生的保存，不带格式名*/
	// 这将会提示用户保存PNG图片
	// Canvas2Image.saveAsPNG(oCanvas);
}

// 保存文件函数
var saveFile = function(data, filename){
    var save_link = document.createElementNS('http://www.w3.org/1999/xhtml', 'a');
    save_link.href = data;
    save_link.download = filename;
   
    var event = document.createEvent('MouseEvents');
    event.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
    save_link.dispatchEvent(event);
};
</script>
</html>